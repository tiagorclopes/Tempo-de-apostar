
<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8">
  <title>Tempo de Apostar</title>
  <link rel="stylesheet" href="style.css">
</head>
<body>
  <h1>Tempo de Apostar</h1>
  
<!-- Botão -->
<button onclick="document.getElementById('modalRegras').style.display='block'" style="margin-top: 10px;">Regras</button>

<!-- Modal -->
<div id="modalRegras" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%);
background:white; border:1px solid #ccc; padding:20px; max-width:500px; box-shadow:0 0 10px rgba(0,0,0,0.2); z-index:100;">
  <h2>Regras do Jogo</h2>
  <ul>
    <li>As apostas devem ser feitas até <strong>23h59 do dia anterior</strong> à data escolhida.</li>
    <li>As informações meteorológicas oficiais são coletadas do site do INMET.</li>
    <li>Os resultados aparecem a partir de <strong>00h01 do dia seguinte</strong>.</li>
    <li>O ranking é semanal e atualizado automaticamente.</li>
  </ul>
  <button onclick="document.getElementById('modalRegras').style.display='none'">Fechar</button>
</div>


  <label>Nome do jogador</label>
  <input type="text" id="nomeJogador">

  <label>Data da aposta</label>
  <input type="date" id="dataAposta">

  <label>Temperatura mínima prevista (°C)</label>
  <input type="number" id="tempMinPrevista">

  <label>Temperatura máxima prevista (°C)</label>
  <input type="number" id="tempMaxPrevista">

  <label>Condição prevista</label>
  <select id="condicaoPrevista">
    <option>Ensolarado</option>
    <option>Parcialmente nublado</option>
    <option>Nublado</option>
    <option>Chuva leve</option>
    <option>Chuva forte</option>
    <option>Tempestade</option>
  </select>

  <hr>

  <label>Temperatura mínima real (°C)</label>
  <input type="number" id="tempMinReal" readonly>

  <label>Temperatura máxima real (°C)</label>
  <input type="number" id="tempMaxReal" readonly>

  <label>Condição real</label>
  <select id="condicaoReal" disabled>
    <option>Ensolarado</option>
    <option>Parcialmente nublado</option>
    <option>Nublado</option>
    <option>Chuva leve</option>
    <option>Chuva forte</option>
    <option>Tempestade</option>
  </select>

  <button onclick="calcularPontuacao()">Calcular Pontuação</button>
  <button onclick="resetarRanking()">Resetar Ranking</button>

  <div id="resultado"></div>

  <div id="ranking">
    <h2>Ranking da Semana Atual</h2>
    <p id="semanaAtual"></p>
    <table id="rankingTabela">
      <thead>
        <tr><th>Jogador</th><th>Pontos</th></tr>
      </thead>
      <tbody></tbody>
    </table>
  </div>

<script>
function getSemanaISO(dataStr) {
  const date = new Date(dataStr);
  const ano = date.getFullYear();
  const primeiraQuinta = new Date(date.setDate(date.getDate() + 3 - (date.getDay() + 6) % 7));
  const semana = Math.ceil((((primeiraQuinta - new Date(ano, 0, 1)) / 86400000) + 1) / 7);
  return `${ano}-W${String(semana).padStart(2, '0')}`;
}

function carregarDadosReais() {
  const data = document.getElementById('dataAposta').value;
  if (!data) return;

  const dados = localStorage.getItem("dadosReais-" + data);
  if (!dados) {
    alert("Dados oficiais ainda não foram inseridos para esta data.");
    return;
  }

  const info = JSON.parse(dados);
  document.getElementById('tempMinReal').value = info.tempMin;
  document.getElementById('tempMaxReal').value = info.tempMax;
  document.getElementById('condicaoReal').value = info.condicao;
}

document.getElementById('dataAposta').addEventListener('change', carregarDadosReais);

function calcularPontuacao() {
  const nome = document.getElementById('nomeJogador').value.trim();
  const data = document.getElementById('dataAposta').value;
  if (!nome || !data) {
    alert("Digite o nome e selecione a data da aposta.");
    return;
  }

  const tempMinPrev = parseFloat(document.getElementById('tempMinPrevista').value);
  const tempMaxPrev = parseFloat(document.getElementById('tempMaxPrevista').value);
  const condPrev = document.getElementById('condicaoPrevista').value;

  const tempMinReal = parseFloat(document.getElementById('tempMinReal').value);
  const tempMaxReal = parseFloat(document.getElementById('tempMaxReal').value);
  const condReal = document.getElementById('condicaoReal').value;

  function pontosTemperatura(prevista, real) {
    const diff = Math.abs(prevista - real);
    if (diff === 0) return 10;
    if (diff <= 1) return 7;
    if (diff <= 2) return 4;
    if (diff <= 3) return 2;
    return 0;
  }

  function pontosCondicao(prev, real) {
    if (prev === real) return 8;
    const vizinhas = {
      "Ensolarado": ["Parcialmente nublado"],
      "Parcialmente nublado": ["Ensolarado", "Nublado"],
      "Nublado": ["Parcialmente nublado", "Chuva leve"],
      "Chuva leve": ["Nublado", "Chuva forte"],
      "Chuva forte": ["Chuva leve", "Tempestade"],
      "Tempestade": ["Chuva forte"]
    };
    return vizinhas[prev]?.includes(real) ? 4 : 0;
  }

  const pontosMin = pontosTemperatura(tempMinPrev, tempMinReal);
  const pontosMax = pontosTemperatura(tempMaxPrev, tempMaxReal);
  const pontosCond = pontosCondicao(condPrev, condReal);
  const total = pontosMin + pontosMax + pontosCond;

  const semana = getSemanaISO(data);
  document.getElementById('semanaAtual').textContent = `Semana: ${semana}`;

  const ranking = JSON.parse(localStorage.getItem('rankingTempo')) || {};
  ranking[semana] = ranking[semana] || {};
  ranking[semana][nome] = (ranking[semana][nome] || 0) + total;
  localStorage.setItem('rankingTempo', JSON.stringify(ranking));

  document.getElementById('resultado').innerHTML =
    `<strong>${nome} (${data}) fez:</strong><br>
     Temp. mínima: ${pontosMin} pontos<br>
     Temp. máxima: ${pontosMax} pontos<br>
     Condição: ${pontosCond} pontos<br><br>
     <strong>Total:</strong> ${total} pontos`;

  exibirRanking();
}

function exibirRanking() {
  const hoje = new Date().toISOString().split('T')[0];
  const semana = getSemanaISO(hoje);
  document.getElementById('semanaAtual').textContent = `Semana: ${semana}`;
  const ranking = JSON.parse(localStorage.getItem('rankingTempo')) || {};
  const dados = ranking[semana] || {};

  const tbody = document.querySelector("#rankingTabela tbody");
  tbody.innerHTML = "";

  const entries = Object.entries(dados).sort((a, b) => b[1] - a[1]);
  for (const [jogador, pontos] of entries) {
    const tr = document.createElement("tr");
    tr.innerHTML = `<td>${jogador}</td><td>${pontos}</td>`;
    tbody.appendChild(tr);
  }
}

function resetarRanking() {
  if (confirm("Tem certeza que deseja resetar o ranking?")) {
    localStorage.removeItem('rankingTempo');
    exibirRanking();
  }
}

window.onload = exibirRanking;
</script>

<!-- Modal -->
<div id="modalRegras" style="display:none; position:fixed; top:10%; left:50%; transform:translateX(-50%);
background:white; border:1px solid #ccc; padding:20px; max-width:500px; box-shadow:0 0 10px rgba(0,0,0,0.2); z-index:100;">
  <h2>Regras do Jogo</h2>
  <ul>
    <li>As apostas devem ser feitas até <strong>23h59 do dia anterior</strong> à data escolhida.</li>
    <li>As informações meteorológicas oficiais são coletadas do site do INMET.</li>
    <li>Os resultados aparecem a partir de <strong>00h01 do dia seguinte</strong>.</li>
    <li>O ranking é semanal e atualizado automaticamente.</li>
  </ul>
  <button onclick="document.getElementById('modalRegras').style.display='none'">Fechar</button>
</div>

<!-- Botão ao final da página -->
<div style="text-align:center; margin-top: 40px;">
  <button onclick="document.getElementById('modalRegras').style.display='block'">Consultar regras</button>
</div>

</body>
</html>
